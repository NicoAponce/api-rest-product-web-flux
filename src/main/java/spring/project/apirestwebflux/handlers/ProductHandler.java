package spring.project.apirestwebflux.handlers;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.http.MediaType;import org.springframework.http.codec.multipart.FilePart;import org.springframework.stereotype.Component;import org.springframework.web.reactive.function.BodyInserters;import org.springframework.web.reactive.function.server.ServerRequest;import org.springframework.web.reactive.function.server.ServerResponse;import reactor.core.publisher.Mono;import spring.project.apirestwebflux.documents.Product;import spring.project.apirestwebflux.services.IProductService;@Componentpublic class ProductHandler {    @Autowired    private IProductService productService;    public Mono<ServerResponse> select(ServerRequest request) {        return ServerResponse.ok()                .contentType(MediaType.APPLICATION_JSON)                .body(productService.select(), Product.class);    }    public Mono<ServerResponse> get(ServerRequest request) {        String id = request.pathVariable("id");        return productService.get(id)                .flatMap(product -> ServerResponse.ok()                        .contentType(MediaType.APPLICATION_JSON)                        .body(BodyInserters.fromObject(product)))                .switchIfEmpty(ServerResponse.notFound().build());    }    public Mono<ServerResponse> insert(ServerRequest request) {        Mono<Product> productMono = request.bodyToMono(Product.class);        return productMono                .flatMap(product -> productService.insert(product))                .flatMap(product -> ServerResponse.ok()                        .contentType(MediaType.APPLICATION_JSON)                        .body(BodyInserters.fromObject(product)));    }    public Mono<ServerResponse> update(ServerRequest request) {        String id = request.pathVariable("id");        Mono<Product> productMono = request.bodyToMono(Product.class);        return productMono                .flatMap(product -> productService.update(product, id))                .flatMap(product -> ServerResponse.ok()                        .contentType(MediaType.APPLICATION_JSON)                        .body(BodyInserters.fromObject(product)));    }    public Mono<ServerResponse> delete(ServerRequest request) {        String id = request.pathVariable("id");        return productService.delete(id)                .flatMap(product -> ServerResponse.ok()                        .body(BodyInserters.fromObject(product)));    }    public Mono<ServerResponse> upload(ServerRequest request) {        String id = request.pathVariable("id");        return request.multipartData().map(data -> data.toSingleValueMap()                .get("filePart"))                .cast(FilePart.class)                .flatMap(filePart -> productService.upload(id, filePart))                .flatMap(product -> ServerResponse.ok()                        .body(BodyInserters.fromObject(product)));    }}